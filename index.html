<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>Rubiks Home | Pro Elite</title>
  <style>
    :root {
      --accent: #00ffa3;
      --accent-glow: rgba(0, 255, 163, 0.3);
      --bg-dark: #0b0e11;
      --card-bg: rgba(255, 255, 255, 0.04);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text: #e0e6ed;
      --danger: #ff4b4b;
      --warning: #ffae00;
      --panel-bg: #14171b;
      --algo-color: #ffcc00;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      margin: 0; padding: 0;
      background-color: var(--bg-dark);
      background-image: radial-gradient(circle at 50% 0%, #1c252e 0%, var(--bg-dark) 80%);
      color: var(--text);
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      overflow-x: hidden;
    }

    /* Header & Scramble */
    .brand-header { margin-top: 30px; text-align: center; }
    .brand-name {
      font-size: 2.2rem; font-weight: 900; letter-spacing: 4px;
      color: #fff; text-shadow: 0 0 15px var(--accent-glow);
      text-transform: uppercase;
    }
    
    #scramble-display {
      font-family: 'JetBrains Mono', monospace; font-size: 1.2rem;
      background: rgba(0,0,0,0.6); padding: 25px; border-radius: 20px;
      margin: 20px auto; color: var(--accent);
      border: 1px solid var(--glass-border); width: 85%; max-width: 900px;
      text-align: center; line-height: 1.6; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    /* Layout */
    .main-grid {
      display: grid; grid-template-columns: 320px 1fr 340px; gap: 20px;
      width: 98%; max-width: 1700px; padding: 10px;
    }

    @media (max-width: 1100px) {
      .main-grid { grid-template-columns: 1fr; }
      .side-panel, .tutorial-pane { height: auto !important; }
    }

    /* Timer Style */
    .timer-container { display: flex; flex-direction: column; gap: 20px; }
    .timer-box {
      background: var(--card-bg); backdrop-filter: blur(15px);
      padding: 110px 20px; border-radius: 35px; border: 1px solid var(--glass-border);
      text-align: center; cursor: pointer; position: relative;
      transition: all 0.3s ease;
    }
    #timer { 
      font-size: 130px; font-weight: 800; font-family: 'JetBrains Mono', monospace;
      font-variant-numeric: tabular-nums;
    }

    .timer-box.inspecting { color: var(--warning); border-color: var(--warning); }
    .timer-box.warning { color: var(--danger); animation: pulse 0.5s infinite; }
    .timer-box.holding { color: var(--danger); transform: scale(0.97); }
    .timer-box.ready { color: var(--accent); border-color: var(--accent); box-shadow: 0 0 50px var(--accent-glow); }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

    /* Panes & Sidebars */
    .tutorial-pane, .side-panel {
      background: var(--panel-bg); padding: 25px; border-radius: 28px;
      height: 78vh; overflow-y: auto; border: 1px solid var(--glass-border);
    }

    /* Updated Step Card Styling */
    .step-card {
      background: rgba(255,255,255,0.03); padding: 15px; border-radius: 14px;
      margin-bottom: 15px; border-left: 4px solid var(--accent);
    }
    .step-card strong { display: block; margin-bottom: 8px; color: #fff; font-size: 0.95rem; }
    
    .algo-group { margin-top: 10px; }
    .algo-desc { font-size: 0.75rem; color: #aaa; margin-bottom: 4px; display: block; }
    .algo-box { 
      background: #000; padding: 8px 12px; border-radius: 6px; 
      color: var(--algo-color); font-family: 'JetBrains Mono', monospace; 
      font-size: 0.85rem; letter-spacing: 1px;
    }

    /* Session & Stats */
    .session-selector {
      background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
      color: white; padding: 8px; border-radius: 8px; width: 100%; margin-bottom: 15px;
    }

    .history-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px; background: rgba(255,255,255,0.02);
      border-radius: 10px; margin-bottom: 8px; font-size: 0.95rem;
    }
    .delete-btn { color: var(--danger); cursor: pointer; font-weight: bold; padding: 0 5px; opacity: 0.5; }
    .delete-btn:hover { opacity: 1; }

    .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .stat-card { background: var(--card-bg); padding: 12px 5px; border-radius: 12px; border: 1px solid var(--glass-border); text-align: center; }
    .stat-label { font-size: 0.6rem; opacity: 0.5; text-transform: uppercase; }
    .stat-value { font-size: 1.1rem; font-weight: 700; color: var(--accent); }

    /* SHOP FIX */
    .shop-container {
      display: flex; flex-direction: column; gap: 15px;
      padding-top: 20px; border-top: 1px solid var(--glass-border); margin-top: 20px;
    }
    .shop-item {
      display: flex; align-items: center; gap: 15px;
      background: rgba(255,255,255,0.03); padding: 10px; border-radius: 15px;
      text-decoration: none; color: inherit; transition: 0.3s;
    }
    .shop-item:hover { background: rgba(255,255,255,0.08); transform: translateX(5px); }
    .shop-item img { width: 60px; height: 60px; border-radius: 8px; background: white; object-fit: contain; }
    .shop-info { text-align: left; }
    .shop-info span { font-size: 0.7rem; opacity: 0.5; display: block; }
    .shop-info strong { font-size: 0.85rem; color: var(--accent); }

    .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
    .btn {
      background: transparent; border: 1px solid var(--glass-border);
      color: var(--text); padding: 12px; border-radius: 10px;
      cursor: pointer; font-weight: 600; transition: 0.3s;
    }
    .btn:hover { background: var(--accent); color: #000; border-color: var(--accent); }

    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
  </style>
</head>
<body>

  <div class="brand-header">
    <div class="brand-name">RUBIKS HOME</div>
  </div>

  <div id="scramble-display">Generating Scramble...</div>

  <main class="main-grid">
    
    <div class="tutorial-pane">
      <h3 style="color:var(--accent); margin-top:0; letter-spacing: 1px;">FULL GUIDE (LBL)</h3>
      
      <div class="step-card">
        <strong>1. WHITE CROSS</strong>
        <p style="font-size:0.8rem; margin:5px 0; color:#ccc;">Create a "Daisy" (yellow center, white edges), then align edges with side centers and turn 180° to white face.</p>
      </div>

      <div class="step-card">
        <strong>2. FIRST LAYER CORNERS</strong>
        <span class="algo-desc">Corner on top-right, white facing side:</span>
        <div class="algo-box">R U R' U'</div>
        <p style="font-size:0.75rem; margin:5px 0; opacity:0.6;">Repeat this "Sexy Move" until the corner is solved.</p>
      </div>

      <div class="step-card">
        <strong>3. SECOND LAYER EDGES</strong>
        <div class="algo-group">
          <span class="algo-desc">Insert Edge to RIGHT:</span>
          <div class="algo-box">U R U' R' U' F' U F</div>
        </div>
        <div class="algo-group">
          <span class="algo-desc">Insert Edge to LEFT:</span>
          <div class="algo-box">U' L' U L U F U' F'</div>
        </div>
      </div>

      <div class="step-card">
        <strong>4. YELLOW CROSS</strong>
        <span class="algo-desc">Case: Line (Horizontal) or L-Shape:</span>
        <div class="algo-box">F (R U R' U') F'</div>
        <p style="font-size:0.75rem; margin:5px 0; opacity:0.6;">Repeat until you see a yellow cross.</p>
      </div>

      <div class="step-card">
        <strong>5. ALIGN YELLOW EDGES</strong>
        <span class="algo-desc">Use "Sune" to rotate edges:</span>
        <div class="algo-box">R U R' U R U2 R'</div>
        <p style="font-size:0.75rem; margin:5px 0; opacity:0.6;">Swap two adjacent incorrect edges until all centers match.</p>
      </div>

      <div class="step-card">
        <strong>6. POSITION CORNERS</strong>
        <span class="algo-desc">Use "Niklas" to swap corners:</span>
        <div class="algo-box">U R U' L' U R' U' L</div>
        <p style="font-size:0.75rem; margin:5px 0; opacity:0.6;">Find one correct corner (even if twisted), hold it front-right, perform algo.</p>
      </div>

      <div class="step-card">
        <strong>7. ORIENT CORNERS</strong>
        <span class="algo-desc">Final Step (Be careful!):</span>
        <div class="algo-box">R' D' R D</div>
        <p style="font-size:0.75rem; margin:5px 0; opacity:0.6;">1. Hold unsolved corner Top-Right.<br>2. Do algo until yellow faces up.<br>3. <b>ONLY turn U layer</b> to bring next corner.<br>4. Repeat.</p>
      </div>
    </div>
    <div class="timer-container">
      <div class="timer-box" id="timer-trigger">
        <div id="timer">0.00</div>
        <div id="status-hint" style="font-size: 0.8rem; opacity: 0.4; margin-top: 20px;">HOLD SPACE TO START</div>
      </div>

      <div class="stats-row">
        <div class="stat-card"><div class="stat-label">Best</div><div class="stat-value" id="pb-val">--</div></div>
        <div class="stat-card"><div class="stat-label">Mo3</div><div class="stat-value" id="mo3-val">--</div></div>
        <div class="stat-card"><div class="stat-label">Ao5</div><div class="stat-value" id="ao5-val">--</div></div>
        <div class="stat-card"><div class="stat-label">Ao12</div><div class="stat-value" id="ao12-val">--</div></div>
      </div>
    </div>

    <aside class="side-panel">
      <select class="session-selector" id="session-select" onchange="changeSession()">
        <option value="1">Session 1</option>
        <option value="2">Session 2</option>
        <option value="3">Session 3</option>
      </select>

      <div class="history-scroll" id="history-list"></div>
      
      <div class="shop-container">
        <h3 style="font-size: 0.9rem; color: var(--accent); margin: 0;">RECOMMENDED GEAR</h3>
        
        <a href="https://cubehouse.store/product/rsc/" target="_blank" class="shop-item">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSLPa-1DJ7Aqmd4Ps4qj9dwvbZycweiUR8ekQ&s" alt="CubeHouse">
          <div class="shop-info">
            <span>Arab Region Shop</span>
            <strong>CubeHouse Special</strong>
          </div>
        </a>

        <a href="https://speedcubeshop.com" target="_blank" class="shop-item">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ3im5QfNcl_8ySSpnUifntYHAl1uF9wgU15A&s" alt="SCS">
          <div class="shop-info">
            <span>Worldwide Shipping</span>
            <strong>MoYu RS3M 2020</strong>
          </div>
        </a>
      </div>

      <div class="btn-group">
        <button class="btn" onclick="exportData()">EXPORT</button>
        <button class="btn" onclick="clearData()" style="color:var(--danger)">WIPE</button>
      </div>
    </aside>
  </main>

  <script>
    let state = 'IDLE';
    let startTime, timerInterval, inspectInterval, holdTimeout;
    let currentSession = "1";
    let solves = JSON.parse(localStorage.getItem('rubiks_home_v6')) || {};

    const timerEl = document.getElementById('timer');
    const trigger = document.getElementById('timer-trigger');
    const hintEl = document.getElementById('status-hint');

    

    function generateScramble() {
      const faces = ['U', 'D', 'L', 'R', 'F', 'B'];
      const mods = ['', "'", '2'];
      let scramble = [];
      let lastFace = -1;
      for (let i = 0; i < 20; i++) {
        let faceIdx;
        do { faceIdx = Math.floor(Math.random() * 6); } while (faceIdx === lastFace);
        scramble.push(faces[faceIdx] + mods[Math.floor(Math.random() * 3)]);
        lastFace = faceIdx;
      }
      document.getElementById('scramble-display').innerText = scramble.join(" ");
    }

    function getSessionSolves() { return solves[currentSession] || []; }

    function updateStats() {
      const s = getSessionSolves();
      const times = s.map(x => x.time);
      
      document.getElementById('pb-val').innerText = times.length ? (Math.min(...times) / 1000).toFixed(2) : "--";
      document.getElementById('mo3-val').innerText = calcAvg(s, 3);
      document.getElementById('ao5-val').innerText = calcAvg(s, 5);
      document.getElementById('ao12-val').innerText = calcAvg(s, 12);

      document.getElementById('history-list').innerHTML = s.slice(0, 15).map((solve, i) => `
        <div class="history-item">
          <span>${(solve.time / 1000).toFixed(2)}s</span>
          <span class="delete-btn" onclick="deleteSolve(${i})">×</span>
        </div>
      `).join('');
    }

    function calcAvg(s, size) {
      if (s.length < size) return "--";
      let lastN = s.slice(0, size).map(x => x.time);
      if (size >= 5) {
        lastN.sort((a,b) => a-b);
        lastN.pop(); lastN.shift();
      }
      return (lastN.reduce((a,b) => a+b, 0) / lastN.length / 1000).toFixed(2);
    }

    function handleStart() {
      if (state === 'RUNNING') stopTimer();
      else if (state === 'IDLE') startInspection();
      else if (state === 'INSPECTING') {
        state = 'HOLDING';
        trigger.classList.add('holding');
        holdTimeout = setTimeout(() => {
          state = 'READY';
          trigger.classList.replace('holding', 'ready');
        }, 300);
      }
    }

    function handleEnd() {
      clearTimeout(holdTimeout);
      if (state === 'READY') startTimer();
      else if (state === 'HOLDING') {
        state = 'INSPECTING';
        trigger.classList.remove('holding');
      }
    }

    function startInspection() {
      state = 'INSPECTING';
      let count = 15;
      timerEl.innerText = count;
      trigger.classList.add('inspecting');
      inspectInterval = setInterval(() => {
        count--;
        timerEl.innerText = count;
        if (count <= 3) trigger.classList.add('warning');
        if (count <= 0) { clearInterval(inspectInterval); startTimer(); }
      }, 1000);
    }

    function startTimer() {
      clearInterval(inspectInterval);
      state = 'RUNNING';
      startTime = Date.now();
      trigger.className = 'timer-box';
      timerInterval = setInterval(() => {
        timerEl.innerText = ((Date.now() - startTime) / 1000).toFixed(2);
      }, 10);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      const finalTime = Date.now() - startTime;
      if(!solves[currentSession]) solves[currentSession] = [];
      solves[currentSession].unshift({ time: finalTime, date: new Date().toLocaleDateString() });
      localStorage.setItem('rubiks_home_v6', JSON.stringify(solves));
      state = 'IDLE';
      timerEl.innerText = (finalTime / 1000).toFixed(2);
      updateStats();
      generateScramble();
    }

    function deleteSolve(idx) {
      solves[currentSession].splice(idx, 1);
      localStorage.setItem('rubiks_home_v6', JSON.stringify(solves));
      updateStats();
    }

    function changeSession() {
      currentSession = document.getElementById('session-select').value;
      updateStats();
    }

    function clearData() { if(confirm("Clear this session?")) { solves[currentSession] = []; updateStats(); } }

    window.addEventListener('keydown', e => { if(e.code === 'Space') { e.preventDefault(); if(!e.repeat) handleStart(); } });
    window.addEventListener('keyup', e => { if(e.code === 'Space') handleEnd(); });
    trigger.addEventListener('pointerdown', e => { e.preventDefault(); handleStart(); });
    window.addEventListener('pointerup', handleEnd);

    generateScramble();
    updateStats();
  </script>
</body>
</html>
